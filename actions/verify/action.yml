# This GitHub action verifies whether a given image has been signed using
# the cosign signature specification.
#
# This is meant to be used for Rancher Prime, or CNCF images that are part
# of the Rancher ecosystem.
#
# Reference usage:
#    steps:
#      ...
#      - uses: rancherlabs/slsactl/actions/verify@main
#        with:
#          image: <registry>/<image>:<tag>

name: verify

inputs:
  image:
    description: |
      The image name component in a fully qualified image. For reference:
      <registry>/<repo>/<image>:<tag>.
    required: true
    type: string

  version:
    description: |
      The slsactl version to be installed.
    required: false
    default: latest
    type: string

runs:
  using: composite

  steps:
  - uses: actions/setup-go@7a3fe6cf4cb3a834922a1244abfce67bcef6a0c5 # v6
    with:
      go-version: 'stable'

  - uses: ./actions/install-slsactl
    with:
      version: ${{ inputs.version }}

  - name: Verify image
    shell: bash
    run: |
      slsactl verify ${{ env.IMAGE }}
    env:
      IMAGE: ${{ inputs.image }}
